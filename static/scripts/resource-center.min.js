(function($){var resources=[],today=new Date,months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ajaxsCounter=0,methods={},defaults={templateMap:{Whitepaper:"generic-template",eBook:"generic-template","Case Study":"case-study-template",Datasheet:"generic-template","Technical Briefs":"generic-template","Archived Webcasts":"webcast-template","WebCast On Demand":"webcast-template","In Person Events":"event-template","Online Events":"event-template","Ooyala Videos":"ooyala-template","Brightcove Videos":"brightcove-template"},templates:{}},opt={};$.fn.resourceCenter=function(options){if(methods[options]){return methods[options].apply(this,Array.prototype.slice.call(arguments,1))}else{opt=$.extend({},defaults,options);opt.target=$(this);for(var i=0;i<opt.listTypeOrder.length;i++){resources.push([])}loadTemplate();$(opt.xml).each(function(i){getXML(this)});return this}};function loadTemplate(){for(var type in opt.templateMap){var id=opt.templateMap[type];opt.templates[id]=$("#"+id).html()}}function getDocumentLibraryAssets(obj){$.ajax({url:obj.url,type:"POST",dataType:"JSON",data:obj.data}).done(function(data){parseDocumentLibraryDataset(obj.type,data.data,obj.product);ajaxsCounter++;if(ajaxsCounter==opt.xml.length){processAllItems()}}).fail(function(){console.log("getXML() failed");console.log(arguments)})}function getXML(obj){$.ajax({url:obj.url,dataType:"xml"}).done(function(data){parseDataset(obj.type,$(data).find("Product"),obj.product,obj.dateWithin);ajaxsCounter++;if(ajaxsCounter==opt.xml.length){processAllItems()}}).fail(function(){console.log("getXML() failed");console.log(arguments)})}function processAllItems(){$(resources).each(function(indx){var newDataset=[];$(resources[indx]).each(function(){var add=true;if(newDataset.length){for(var cntr in newDataset){if(newDataset[cntr].url==this.url){add=false;for(var indx2 in resources[indx]){for(var productIndx in resources[indx][indx2].products){if($.inArray(resources[indx][indx2].products[productIndx],newDataset[cntr].products)==-1){newDataset[cntr].products.push(resources[indx][indx2].products[productIndx])}}}break}}}if(add){newDataset.push(this)}});newDataset=sort(indx,newDataset);resources[indx]=newDataset});renderItems();displayFilters();bindFilter();opt.target.find(".description").dotdotdot();opt.target.isotope({itemSelector:"li"})}function bindFilter(){var lis=opt.target.find("li");$(opt.filterTarget).on("click","a",function(e){e.preventDefault();$(this).parents("ul").find("a").removeClass("active");$(this).addClass("active");var filterClass=[];$(opt.filterTarget).find(".active").each(function(){var filterVal=$(this).data("filter");if(filterVal!=""){filterClass.push(filterVal)}});filterClass="."+filterClass.join(".");if(filterClass!="."&&!lis.filter(filterClass).length){if(typeof opt.noResult=="string"){opt.noResult=$(opt.noResult);opt.noResult.insertBefore(opt.target)}opt.noResult.show()}else if(typeof opt.noResult!="string"){opt.noResult.hide()}opt.target.isotope({filter:filterClass=="."?"*":filterClass});$(this).parents(".dropdown").find(".display").text($(this).text())});$(window).load(function(){setTimeout(function(){$(opt.filterTarget).find("a").each(function(){$(this).attr("onclick","")})},100)})}function displayFilters(){for(var indx in opt.filter){$(opt.filter[indx].data).each(function(){if(this.show===true){$(opt.filter[indx].target).append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" data-filter="'+this.className+'">'+this.display+"</a></li>")}})}}function sort(indx,data){if(opt.sort[indx].format=="date"){if(opt.sort[indx].sortby=="DESC"){data=data.sort(function(a,b){a=new Date(a.date);b=new Date(b.date);return a>b?-1:a<b?1:0})}else if(opt.sort[indx].sortby=="ASC"){data=data.sort(function(a,b){a=new Date(a.date);b=new Date(b.date);return a<b?-1:a>b?1:0})}}return data}function renderItems(){var cntr=0,group=0,prev="",complete=[];for(var i=0;i<resources.length;i++){complete.push(false)}while(true){var classes=[],entry={},isComplete=true,code="";if(typeof resources[group][cntr]=="undefined"){complete[group]=true;for(var i in complete){if(!complete[i]){isComplete=false;break}}if(isComplete){break}if(group==opt.listTypeOrder.length-1){group=0;cntr++}else{group++}continue}entry=resources[group][cntr];for(var indx in opt.filter){$(opt.filter[indx].data).each(function(dataIndx){if(typeof entry[this.testAgainst]=="string"){if($.inArray(entry[this.testAgainst],this.testValue)>-1){classes.push(this.className);opt.filter[indx].data[dataIndx].show=true}}else{for(var item in entry[this.testAgainst]){if($.inArray(entry[this.testAgainst][item],this.testValue)>-1){classes.push(this.className);opt.filter[indx].data[dataIndx].show=true}}}})}classes.push(entry.type.replace(/\s/g,"-").toLowerCase());var templateMap={url:entry.url,"class":classes.join(" "),description:entry.name};if($.inArray(entry.type,["In Person Events","Online Events"])>-1){var eventDate=new Date(entry.date);templateMap.month=months[eventDate.getMonth()];templateMap.day=eventDate.getDate();templateMap.descriptionHover="Register Now &#155;";templateMap.stateCountry=entry.stateCountry;templateMap.time=entry.time;templateMap.locationTimeClass=""}else if(entry.type=="Brightcove Videos"){templateMap.image=entry.image;templateMap.descriptionHover="Watch Video &#155;";templateMap.config="{'videoID': "+entry.brightcoveID+", 'title': '"+entry.name.replace(/\'/g,"&amp;#39;")+"'}";templateMap.imageID="BC"+cntr;getBrightcoveImage(entry.brightcoveID,templateMap.imageID)}else if(entry.type=="Ooyala Videos"){templateMap.image=entry.image;templateMap.descriptionHover="Watch Video &#155;";templateMap.config="{'ooyala': '"+entry.ooyalaID+"', '3Play': '', 'description':'"+entry.description.replace(/\'/g,"&amp;#39;")+"', 'url':'/video/"+entry.url+"', 'title': '"+entry.name.replace(/\'/g,"&amp;#39;")+"'}";templateMap.imageID="OY"+cntr}else if($.inArray(entry.type,["Archived Webcasts","WebCast On Demand"])>-1){templateMap.image="/images/shared/icon-video.jpg";templateMap.descriptionHover="Watch On-Demand Webcast &#155;"}else if(entry.type=="Case Study"){templateMap.descriptionHover="Read the Case Study &#155;";templateMap.image=entry.image;if(typeof entry.quote=="undefined"||typeof entry.author=="undefined"||typeof entry.logo=="undefined"||(entry.quote==""||entry.author==""||entry.logo=="")){code=opt.templates["generic-template"]}else{templateMap.logo=entry.logo;templateMap.quote=entry.quote;templateMap.author=entry.author}}else{templateMap.image=entry.image;if(entry.type=="Technical Briefs"){templateMap.descriptionHover="Read the Technical Brief &#155;"}else if(entry.type=="Whitepaper"){templateMap.descriptionHover="Read the White Paper &#155;"}else if(entry.type=="Datasheet"){templateMap.descriptionHover="Read the Datasheet &#155;"}else if(entry.type=="eBook"){templateMap.descriptionHover="Read the eBook &#155;"}}code=code==""?opt.templates[opt.templateMap[entry.type]]:code;for(var tm in templateMap){code=code.replace("[["+tm+"]]",templateMap[tm]).replace('<img src="">',"")}opt.target.append(code);if(group==opt.listTypeOrder.length-1){group=0;cntr++}else{group++}}}function getBrightcoveImage(brightcoveID,imageID){$.ajax({url:"http://api.brightcove.com/services/library?command=find_video_by_id&token=Hauwo3UUsIHcsRjweLYhdfuzx8S2LN1UVLWmmDQseDev33WmXR_kKg..&video_id="+brightcoveID,dataType:"jsonp"}).done(function(data){$("#"+imageID).attr("src",data.videoStillURL)})}function parseDocumentLibraryDataset(pullType,dataset,associatedProduct){for(var typeName in pullType){dateWithin=pullType[typeName];dataset.each(function(){var publishDate=today,products=[],obj={name:stripText(obj.title),type:this.documenttype,date:obj.date,url:obj.url};if($(this).find("product").length==0){products.push(associatedProduct)}else{$(this).find("product").each(function(){var productName=$(this).text();products.push(productName.toLowerCase())})}obj.products=[associatedProduct];if(obj.type=="Brightcove Videos"){obj.brightcoveID=$(this).find("brightcoveID").text();obj.image="";obj.url=obj.brightcoveID}else if(obj.type=="Ooyala Videos"){obj.ooyalaID=$(this).find("ooyalaID").text();obj.image=$(this).find("image").text();obj.url=$(this).find("url").text();obj.description=$(this).find("description").text()}else if(obj.type=="Case Study"){obj.image=$(this).find("documentimage").text();obj.quote=stripText($(this).find("quotetext").text());obj.author=stripText($(this).find("quoteauthor").text());obj.logo=stripText($(this).find("logo").text())}else if(obj.type=="WebCast On Demand"){obj.date=publishDate=$(this).find("recordeddate").text()}else if(obj.type=="Online Events"||obj.type=="In Person Events"){obj.date=publishDate=$(this).find("eventdate").text();obj.state=stripText($(this).find("eventstate").text());obj.country=$(this).find("country").text();obj.stateCountry=(obj.state!=""?obj.state+", ":"")+obj.country;obj.time=stripText($(this).find("eventstarttime").text())+" "+stripText($(this).find("eventtimezone").text())}else if(obj.type=="Case Study"){obj.quote=stripText($(this).find("quotetext").text());obj.author=stripText($(this).find("quoteauthor").text());obj.logo=stripText($(this).find("logo").text())}else{obj.date=publishDate=$(this).find("publishdate").text();obj.image=$(this).find("documentimage").text()}if(publishDate.length){publishDate=new Date(publishDate)}if(dateWithin===false||today.getTime()<=publishDate.getTime()+dateWithin){for(var i in opt.listTypeOrder){if($.inArray(obj.type,opt.listTypeOrder[i])>-1){resources[i].push(obj);break}}}})}}function parseDataset(pullType,dataset,associatedProduct,dateWithin){for(var pullTypeIndx in pullType){var typeName="";if(isNaN(pullTypeIndx)){typeName=pullTypeIndx;dateWithin=pullType[pullTypeIndx]}else{typeName=pullType[pullTypeIndx]}dataset.find(typeName).find("Item").each(function(){if($(this).find("language").text()=="English"){var publishDate=today,products=[],obj={name:stripText($(this).find("name").text()),type:$(this).find("type").text(),date:$(this).find("publishdate").text(),url:$(this).find("url").text()};if($(this).find("product").length==0){products.push(associatedProduct)}else{$(this).find("product").each(function(){var productName=$(this).text();products.push(productName.toLowerCase())})}obj.products=products;if(obj.type=="Brightcove Videos"){obj.brightcoveID=$(this).find("brightcoveID").text();obj.image="";obj.url=obj.brightcoveID}else if(obj.type=="Ooyala Videos"){obj.ooyalaID=$(this).find("ooyalaID").text();obj.image=$(this).find("image").text();obj.url=$(this).find("url").text();obj.description=$(this).find("description").text()}else if(obj.type=="Case Study"){obj.image=$(this).find("documentimage").text();obj.quote=stripText($(this).find("quotetext").text());obj.author=stripText($(this).find("quoteauthor").text());obj.logo=stripText($(this).find("logo").text())}else if(obj.type=="WebCast On Demand"){obj.date=publishDate=$(this).find("recordeddate").text()}else if(obj.type=="Online Events"||obj.type=="In Person Events"){obj.date=publishDate=$(this).find("eventdate").text();obj.state=stripText($(this).find("eventstate").text());obj.country=$(this).find("country").text();obj.stateCountry=(obj.state!=""?obj.state+", ":"")+obj.country;obj.time=stripText($(this).find("eventstarttime").text())+" "+stripText($(this).find("eventtimezone").text())}else if(obj.type=="Case Study"){obj.quote=stripText($(this).find("quotetext").text());obj.author=stripText($(this).find("quoteauthor").text());obj.logo=stripText($(this).find("logo").text())}else if(obj.type=="Datasheet"){obj.date=publishDate=$(this).find("publishdate").text();obj.image=$(this).find("documentimage").text();if(obj.image==""){obj.image="/images/asset/datasheet.jpg"}}else{obj.date=publishDate=$(this).find("publishdate").text();obj.image=$(this).find("documentimage").text()}if(publishDate.length){publishDate=new Date(publishDate)}if(dateWithin===false||today.getTime()<=publishDate.getTime()+dateWithin){for(var i in opt.listTypeOrder){if($.inArray(obj.type,opt.listTypeOrder[i])>-1){resources[i].push(obj);break}}}}})}}function stripText(value){var matchValue=value.match(/<!\[CDATA\[(.*?)\]\]>/);if(matchValue===null){return value}else{return matchValue[1]}}})(jQuery);