/*
 * FancyBox - jQuery Plugin
 * Simple and fancy lightbox alternative
 *
 * Examples and documentation at: http://fancybox.net
 *
 * Copyright (c) 2008 - 2010 Janis Skarnelis
 * That said, it is hardly a one-person project. Many people have submitted bugs, code, and offered their advice freely. Their support is greatly appreciated.
 *
 * Version: 1.3.4 (11/11/2010)
 * Requires: jQuery v1.3+
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(C){var M,T,R,N,d,n,K,B,P,A,D=0,I={},j=[],e=0,H={},z=[],f=null,p=new Image(),i=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,l=/[^\.]\.(swf)\s*$/i,q,O=1,h=0,u="",b,c,Q=false,t=C.extend(C("<div/>")[0],{prop:0}),k=(C("html").hasClass("ie7")||C("html").hasClass("ie8")),s=function(){T.hide();p.onerror=p.onload=null;if(f){f.abort()}M.empty()},y=function(){if(false===I.onError(j,D,I)){T.hide();Q=false;return}I.titleShow=false;I.width="auto";I.height="auto";M.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');o()},x=function(){var Z=j[D],W,Y,ab,aa,V,X;s();I=C.extend({},C.fn.fancybox.defaults,(typeof C(Z).data("fancybox")=="undefined"?I:C(Z).data("fancybox")));X=I.onStart(j,D,I);if(X===false){Q=false;return}else{if(typeof X=="object"){I=C.extend(I,X)}}ab=I.title||(Z.nodeName?C(Z).attr("title"):Z.title)||"";if(Z.nodeName&&!I.orig){I.orig=C(Z).children("img:first").length?C(Z).children("img:first"):C(Z)}if(ab===""&&I.orig&&I.titleFromAlt){ab=I.orig.attr("alt")}W=I.href||(Z.nodeName?C(Z).attr("href"):Z.href)||null;if((/^(?:javascript)/i).test(W)||W=="#"){W=null}if(I.type){Y=I.type;if(!W){W=I.content}}else{if(I.content){Y="html"}else{if(W){if(W.match(i)){Y="image"}else{if(W.match(l)){Y="swf"}else{if(C(Z).hasClass("iframe")){Y="iframe"}else{if(W.indexOf("#")===0){Y="inline"}else{Y="ajax"}}}}}}}if(!Y){y();return}if(Y=="inline"){Z=W.substr(W.indexOf("#"));Y=C(Z).length>0?"inline":"ajax"}I.type=Y;I.href=W;I.title=ab;if(I.autoDimensions){if(I.type=="html"||I.type=="inline"||I.type=="ajax"){I.width="auto";I.height="auto"}else{I.autoDimensions=false}}if(I.modal){I.overlayShow=true;I.hideOnOverlayClick=false;I.hideOnContentClick=false;I.enableEscapeButton=false;I.showCloseButton=false}I.padding=parseInt(I.padding,10);I.margin=parseInt(I.margin,10);M.css("padding",(I.padding+I.margin));C(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){C(this).replaceWith(n.children())});switch(Y){case"html":M.html(I.content);o();break;case"inline":if(C(Z).parent().is("#fancybox-content")===true){Q=false;return}C('<div class="fancybox-inline-tmp" />').hide().insertBefore(C(Z)).bind("fancybox-cleanup",function(){C(this).replaceWith(n.children())}).bind("fancybox-cancel",function(){C(this).replaceWith(M.children())});C(Z).appendTo(M);o();break;case"image":Q=false;C.fancybox.showActivity();p=new Image();p.onerror=function(){y()};p.onload=function(){Q=true;p.onerror=p.onload=null;G()};p.src=W;break;case"swf":I.scrolling="no";aa='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+I.width+'" height="'+I.height+'"><param name="movie" value="'+W+'"></param>';V="";C.each(I.swf,function(ac,ad){aa+='<param name="'+ac+'" value="'+ad+'"></param>';V+=" "+ac+'="'+ad+'"'});aa+='<embed src="'+W+'" type="application/x-shockwave-flash" width="'+I.width+'" height="'+I.height+'"'+V+"></embed></object>";M.html(aa);o();break;case"ajax":Q=false;C.fancybox.showActivity();I.ajax.win=I.ajax.success;f=C.ajax(C.extend({},I.ajax,{url:W,data:I.ajax.data||{},error:function(ac,ae,ad){if(ac.status>0){y()}},success:function(ad,af,ac){var ae=typeof ac=="object"?ac:f;if(ae.status==200){if(typeof I.ajax.win=="function"){X=I.ajax.win(W,ad,af,ac);if(X===false){T.hide();return}else{if(typeof X=="string"||typeof X=="object"){ad=X}}}M.html(ad);o()}}}));break;case"iframe":F();break}},o=function(){var V=I.width,W=I.height;if(V.toString().indexOf("%")>-1){V=parseInt((C(window).width()-(I.margin*2))*parseFloat(V)/100,10)+"px"}else{V=V=="auto"?"auto":V+"px"}if(W.toString().indexOf("%")>-1){W=parseInt((C(window).height()-(I.margin*2))*parseFloat(W)/100,10)+"px"}else{W=W=="auto"?"auto":W+"px"}M.wrapInner('<div style="width:'+V+";height:"+W+";overflow: "+(I.scrolling=="auto"?"auto":(I.scrolling=="yes"?"scroll":"hidden"))+';position:relative;"></div>');I.width=M.width();I.height=M.height();F()},G=function(){I.width=p.width;I.height=p.height;C("<img />").attr({id:"fancybox-img",src:p.src,alt:I.title}).appendTo(M);F()},F=function(){var Y,X;T.hide();if(N.is(":visible")&&false===H.onCleanup(z,e,H)){C.event.trigger("fancybox-cancel");Q=false;return}Q=true;C(n.add(R)).unbind();C(window).unbind("resize.fb scroll.fb");C(document).unbind("keydown.fb");if(N.is(":visible")&&H.titlePosition!=="outside"){N.css("height",N.height())}z=j;e=D;H=I;if(H.overlayShow){R.css({"background-color":H.overlayColor,opacity:H.overlayOpacity,cursor:H.hideOnOverlayClick?"pointer":"auto",height:C(document).height()});if(!R.is(":visible")){R.show()}}else{R.hide()}c=S();m();if(N.is(":visible")){C(K.add(P).add(A)).hide();Y=N.position(),b={top:Y.top,left:Y.left,width:N.width(),height:N.height()};X=(b.width==c.width&&b.height==c.height);n.fadeTo(H.changeFade,0.3,function(){var Z=function(){n.html(M.contents()).fadeTo(H.changeFade,1,w)};C.event.trigger("fancybox-change");n.empty().removeAttr("filter").css({"border-width":H.padding,width:c.width-H.padding*2,height:I.autoDimensions?"auto":c.height-h-H.padding*2});if(X){Z()}else{t.prop=0;C(t).animate({prop:1},{duration:H.changeSpeed,easing:H.easingChange,step:U,complete:Z})}});return}N.removeAttr("style");n.css("border-width",H.padding);if(H.transitionIn=="elastic"){b=J();n.html(M.contents());N.show();if(H.opacity){c.opacity=0}t.prop=0;C(t).animate({prop:1},{duration:H.speedIn,easing:H.easingIn,step:U,complete:w});return}if(H.titlePosition=="inside"&&h>0){B.show()}n.css({width:c.width-H.padding*2,height:I.autoDimensions?"auto":c.height-h-H.padding*2}).html(M.contents());N.css(c).fadeIn(H.transitionIn=="none"?0:H.speedIn,w);var V=v();var W=parseInt(Math.max(V[3]-20,V[3]+((V[1]-n.height())*0.5)-H.padding));if(typeof H["min-top"]=="number"){if(W<H["min-top"]){W=H["min-top"]}}if(typeof H.top=="number"){W=H.top}N.css({top:W,left:parseInt(Math.max(V[2]-20,V[2]+((V[0]-n.width())*0.5)-H.padding))})},E=function(V){if(V&&V.length){if(H.titlePosition=="float"){return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+V+'</td><td id="fancybox-title-float-right"></td></tr></table>'}return'<div id="fancybox-title-'+H.titlePosition+'">'+V+"</div>"}return false},m=function(){u=H.title||"";h=0;B.empty().removeAttr("style").removeClass();if(H.titleShow===false){B.hide();return}u=C.isFunction(H.titleFormat)?H.titleFormat(u,z,e,H):E(u);if(!u||u===""){B.hide();return}B.addClass("fancybox-title-"+H.titlePosition).html(u).appendTo("body").show();switch(H.titlePosition){case"inside":B.css({width:c.width-(H.padding*2),marginLeft:H.padding,marginRight:H.padding});h=B.outerHeight(true);B.appendTo(d);c.height+=h;break;case"over":B.css({marginLeft:H.padding,width:c.width-(H.padding*2),bottom:H.padding}).appendTo(d);break;case"float":B.css("left",parseInt((B.width()-c.width-40)/2,10)*-1).appendTo(N);break;default:B.css({width:c.width-(H.padding*2),paddingLeft:H.padding,paddingRight:H.padding}).appendTo(N);break}B.hide()},g=function(){if(H.enableEscapeButton||H.enableKeyboardNav){C(document).bind("keydown.fb",function(V){if(V.keyCode==27&&H.enableEscapeButton){V.preventDefault();C.fancybox.close()}else{if((V.keyCode==37||V.keyCode==39)&&H.enableKeyboardNav&&V.target.tagName!=="INPUT"&&V.target.tagName!=="TEXTAREA"&&V.target.tagName!=="SELECT"){V.preventDefault();C.fancybox[V.keyCode==37?"prev":"next"]()}}})}if(!H.showNavArrows){P.hide();A.hide();return}if((H.cyclic&&z.length>1)||e!==0){P.show()}if((H.cyclic&&z.length>1)||e!=(z.length-1)){A.show()}},w=function(){if(!C.support.opacity){n.get(0).style.removeAttribute("filter");N.get(0).style.removeAttribute("filter")}if(I.autoDimensions){n.css("height","auto")}N.css("height","auto");if(u&&u.length){B.show()}if(H.showCloseButton){K.show()}g();if(H.hideOnContentClick){n.bind("click",C.fancybox.close)}if(H.hideOnOverlayClick){R.bind("click",C.fancybox.close)}C(window).bind("resize.fb",C.fancybox.resize);if(H.centerOnScroll){C(window).bind("scroll.fb",C.fancybox.center)}if(H.type=="iframe"){C('<iframe id="fancybox-frame" name="fancybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" '+(k?'allowtransparency="true""':"")+' scrolling="'+I.scrolling+'" src="'+H.href+'"></iframe>').appendTo(n)}N.show();Q=false;C.fancybox.center();H.onComplete(z,e,H);L()},L=function(){var V,W;if((z.length-1)>e){V=z[e+1].href;if(typeof V!=="undefined"&&V.match(i)){W=new Image();W.src=V}}if(e>0){V=z[e-1].href;if(typeof V!=="undefined"&&V.match(i)){W=new Image();W.src=V}}},U=function(W){var V={width:parseInt(b.width+(c.width-b.width)*W,10),height:parseInt(b.height+(c.height-b.height)*W,10),top:parseInt(b.top+(c.top-b.top)*W,10),left:parseInt(b.left+(c.left-b.left)*W,10)};if(typeof c.opacity!=="undefined"){V.opacity=W<0.5?0.5:W}N.css(V);n.css({width:V.width-H.padding*2,height:V.height-(h*W)-H.padding*2})},v=function(){return[C(window).width()-(H.margin*2),C(window).height()-(H.margin*2),C(document).scrollLeft()+H.margin,C(document).scrollTop()+H.margin]},S=function(){var V=v(),Z={},W=H.autoScale,X=H.padding*2,Y;if(H.width.toString().indexOf("%")>-1){Z.width=parseInt((V[0]*parseFloat(H.width))/100,10)}else{Z.width=H.width+X}if(H.height.toString().indexOf("%")>-1){Z.height=parseInt((V[1]*parseFloat(H.height))/100,10)}else{Z.height=H.height+X}if(W&&(Z.width>V[0]||Z.height>V[1])){if(I.type=="image"||I.type=="swf"){Y=(H.width)/(H.height);if((Z.width)>V[0]){Z.width=V[0];Z.height=parseInt(((Z.width-X)/Y)+X,10)}if((Z.height)>V[1]){Z.height=V[1];Z.width=parseInt(((Z.height-X)*Y)+X,10)}}else{Z.width=Math.min(Z.width,V[0]);Z.height=Math.min(Z.height,V[1])}}Z.top=parseInt(Math.max(V[3]-20,20+V[3]+((V[1]-Z.height-40)*0.5)),10);Z.left=parseInt(Math.max(V[2]-20,20+V[2]+((V[0]-Z.width-40)*0.5)),10);return Z},r=function(V){var W=V.offset();W.top+=parseInt(V.css("paddingTop"),10)||0;W.left+=parseInt(V.css("paddingLeft"),10)||0;W.top+=parseInt(V.css("border-top-width"),10)||0;W.left+=parseInt(V.css("border-left-width"),10)||0;W.width=V.width();W.height=V.height();return W},J=function(){var Y=I.orig?C(I.orig):false,X={},W,V;if(Y&&Y.length){W=r(Y);X={width:W.width+(H.padding*2),height:W.height+(H.padding*2),top:W.top-H.padding-20,left:W.left-H.padding-20}}else{V=v();X={width:H.padding*2,height:H.padding*2,top:parseInt(V[3]+V[1]*0.5,10),left:parseInt(V[2]+V[0]*0.5,10)}}return X},a=function(){if(!T.is(":visible")){clearInterval(q);return}C("div",T).css("top",(O*-40)+"px");O=(O+1)%12};C.fn.fancybox=function(V){if(!C(this).length){return this}C(this).data("fancybox",C.extend({},V,(C.metadata?C(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(X){X.preventDefault();if(Q){return}Q=true;C(this).blur();j=[];D=0;var W=C(this).attr("rel")||"";if(!W||W==""||W==="nofollow"){j.push(this)}else{j=C("a[rel="+W+"], area[rel="+W+"]");D=j.index(this)}x();return});return this};C.fancybox=function(Y){var X;if(Q){return}Q=true;X=typeof arguments[1]!=="undefined"?arguments[1]:{};j=[];D=parseInt(X.index,10)||0;if(C.isArray(Y)){for(var W=0,V=Y.length;W<V;W++){if(typeof Y[W]=="object"){C(Y[W]).data("fancybox",C.extend({},X,Y[W]))}else{Y[W]=C({}).data("fancybox",C.extend({content:Y[W]},X))}}j=jQuery.merge(j,Y)}else{if(typeof Y=="object"){C(Y).data("fancybox",C.extend({},X,Y))}else{Y=C({}).data("fancybox",C.extend({content:Y},X))}j.push(Y)}if(D>j.length||D<0){D=0}x()};C.fancybox.showActivity=function(){clearInterval(q);T.show();q=setInterval(a,66)};C.fancybox.hideActivity=function(){T.hide()};C.fancybox.next=function(){return C.fancybox.pos(e+1)};C.fancybox.prev=function(){return C.fancybox.pos(e-1)};C.fancybox.pos=function(V){if(Q){return}V=parseInt(V);j=z;if(V>-1&&V<z.length){D=V;x()}else{if(H.cyclic&&z.length>1){D=V>=z.length?0:z.length-1;x()}}return};C.fancybox.cancel=function(){if(Q){return}Q=true;C.event.trigger("fancybox-cancel");s();I.onCancel(j,D,I);Q=false};C.fancybox.close=function(){if(Q||N.is(":hidden")){return}Q=true;if(H&&false===H.onCleanup(z,e,H)){Q=false;return}s();C(K.add(P).add(A)).hide();C(n.add(R)).unbind();C(window).unbind("resize.fb scroll.fb");C(document).unbind("keydown.fb");n.find("iframe").attr("src","about:blank");if(H.titlePosition!=="inside"){B.empty()}N.stop();function V(){R.fadeOut("fast");B.empty().hide();N.hide();C(".fancybox-inline-tmp").trigger("fancybox-cleanup");n.empty();H.onClosed(z,e,H);z=I=[];e=D=0;H=I={};Q=false}if(H.transitionOut=="elastic"){b=J();var W=N.position();c={top:W.top,left:W.left,width:N.width(),height:N.height()};if(H.opacity){c.opacity=1}B.empty().hide();t.prop=1;C(t).animate({prop:0},{duration:H.speedOut,easing:H.easingOut,step:U,complete:V})}else{N.fadeOut(H.transitionOut=="none"?0:H.speedOut,V)}};C.fancybox.resize=function(){if(R.is(":visible")){R.css("height",C(document).height())}C.fancybox.center(true)};C.fancybox.center=function(){var V,X;if(Q){return}X=arguments[0]===true?1:0;V=v();if(!X&&(N.width()>V[0]||N.height()>V[1])){return}var W=parseInt(Math.max(V[3]-20,V[3]+((V[1]-n.height())*0.5)-H.padding));if(typeof H["min-top"]=="number"){if(W<H["min-top"]){W=H["min-top"]}}if(typeof H.top=="number"){W=H.top}N.stop().animate({top:W,left:parseInt(Math.max(V[2]-20,V[2]+((V[0]-n.width())*0.5)-H.padding))},typeof arguments[0]=="number"?arguments[0]:200)};C.fancybox.init=function(){if(C("#fancybox-wrap").length){return}C("body").append(M=C('<div id="fancybox-tmp"></div>'),T=C('<div id="fancybox-loading"><div></div></div>'),R=C('<div id="fancybox-overlay"></div>'),N=C('<div id="fancybox-wrap"></div>'));d=C('<div id="fancybox-outer"></div>').appendTo(N);d.append(n=C('<div id="fancybox-content"></div>'),K=C('<a id="fancybox-close"></a>'),B=C('<div id="fancybox-title"></div>'),P=C('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),A=C('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));K.click(C.fancybox.close);T.click(C.fancybox.cancel);P.click(function(V){V.preventDefault();C.fancybox.prev()});A.click(function(V){V.preventDefault();C.fancybox.next()});if(C.fn.mousewheel){N.bind("mousewheel.fb",function(V,W){if(Q){V.preventDefault()}else{if(C(V.target).get(0).clientHeight==0||C(V.target).get(0).scrollHeight===C(V.target).get(0).clientHeight){V.preventDefault();C.fancybox[W>0?"prev":"next"]()}}})}if(!C.support.opacity){N.addClass("fancybox-ie")}};C.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};C(document).ready(function(){C.fancybox.init()})})(jQuery);